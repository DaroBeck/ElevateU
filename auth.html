<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>ElevateU | Sign in</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./auth.css" />
</head>

<body>
  <div class="eu-authPage">
    <a class="eu-authBrand" href="./index.html" aria-label="Back to home">
      <img src="./assets/elevateu-logo.png" alt="ElevateU logo" class="eu-authLogo" />
      <span class="eu-authBrandText">ElevateU</span>
    </a>

    <main class="eu-authCard" role="main">
      <header class="eu-authHeader">
        <h1 class="eu-authTitle" id="authTitle">Welcome back</h1>
        <p class="eu-authSubtitle" id="authSubtitle">
          Sign in using email/password or a provider.
        </p>
      </header>

      <!-- Tabs -->
      <div class="eu-authTabs" role="tablist" aria-label="Authentication">
        <button class="eu-tab is-active" type="button" role="tab" aria-selected="true" data-mode="signin">
          Sign in
        </button>
        <button class="eu-tab" type="button" role="tab" aria-selected="false" data-mode="signup">
          Sign up
        </button>
      </div>

      <!-- Providers -->
      <section class="eu-providerBlock" aria-label="Third party login">
        <div class="eu-providerGrid">
          <button class="eu-providerBtn" type="button" data-provider="google">
            <span class="eu-providerIcon" aria-hidden="true">G</span>
            Continue with Google
          </button>

          <button class="eu-providerBtn" type="button" data-provider="github">
            <span class="eu-providerIcon" aria-hidden="true">‚åÇ</span>
            Continue with GitHub
          </button>

          <button class="eu-providerBtn" type="button" data-provider="apple">
            <span class="eu-providerIcon" aria-hidden="true">Ô£ø</span>
            Continue with Apple
          </button>

          <button class="eu-providerBtn" type="button" data-provider="discord">
            <span class="eu-providerIcon" aria-hidden="true">‚óí</span>
            Continue with Discord
          </button>
        </div>

        <div class="eu-divider">
          <span>or</span>
        </div>
      </section>

      <!-- Email + Password -->
      <form class="eu-form" id="authForm" autocomplete="on" novalidate>
        <div class="eu-field">
          <label class="eu-label" for="email">Email</label>
          <input class="eu-input" id="email" name="email" type="email" placeholder="you@example.com" required />
          <div class="eu-help" id="emailHelp" aria-live="polite"></div>
        </div>

        <div class="eu-field">
          <label class="eu-label" for="password">Password</label>
          <div class="eu-passwordRow">
            <input class="eu-input" id="password" name="password" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required minlength="6" />
            <button class="eu-eye" type="button" id="togglePw" aria-label="Show password">üëÅ</button>
          </div>
          <div class="eu-help" id="passwordHelp" aria-live="polite"></div>
        </div>

        <div class="eu-row">
          <label class="eu-check">
            <input type="checkbox" id="remember" />
            <span>Remember me</span>
          </label>

          <a class="eu-link" href="./forgot-password.html">Forgot password?</a>
        </div>

        <button class="eu-primary" type="submit" id="submitBtn">
          Sign in
        </button>

        <p class="eu-footnote" id="footnote">
          New here? Create an account to personalise your learning.
        </p>
      </form>
    </main>

    <footer class="eu-authFooter">
      <small>¬© <span id="year"></span> ElevateU</small>
    </footer>
  </div>

  <script>
    // --------- CONFIG (edit routes here) ---------
    const ROUTES = {
      hub: "./hub.html",                    // returning users go here
      personalisation: "./personalisation.html", // new users go here
      providerCallback: "./oauth-callback.html"  // optional placeholder
    };

    // Set year
    document.getElementById("year").textContent = new Date().getFullYear();

    // Mode switching
    const tabs = document.querySelectorAll(".eu-tab");
    const title = document.getElementById("authTitle");
    const subtitle = document.getElementById("authSubtitle");
    const submitBtn = document.getElementById("submitBtn");
    const footnote = document.getElementById("footnote");

    let mode = "signin"; // "signin" | "signup"

    function setMode(nextMode){
      mode = nextMode;

      tabs.forEach(t => {
        const active = t.dataset.mode === mode;
        t.classList.toggle("is-active", active);
        t.setAttribute("aria-selected", String(active));
      });

      if(mode === "signin"){
        document.title = "ElevateU | Sign in";
        title.textContent = "Welcome back";
        subtitle.textContent = "Sign in using email/password or a provider.";
        submitBtn.textContent = "Sign in";
        footnote.textContent = "New here? Create an account to personalise your learning.";
      }else{
        document.title = "ElevateU | Sign up";
        title.textContent = "Create your account";
        subtitle.textContent = "Sign up using email/password or a provider.";
        submitBtn.textContent = "Sign up";
        footnote.textContent = "Already have an account? Sign in instead.";
      }

      clearErrors();
    }

    tabs.forEach(t => t.addEventListener("click", () => setMode(t.dataset.mode)));

    // Password toggle
    const pw = document.getElementById("password");
    const togglePw = document.getElementById("togglePw");
    togglePw.addEventListener("click", () => {
      const isPw = pw.type === "password";
      pw.type = isPw ? "text" : "password";
      togglePw.textContent = isPw ? "üôà" : "üëÅ";
      togglePw.setAttribute("aria-label", isPw ? "Hide password" : "Show password");
    });

    // Basic validation UI
    const email = document.getElementById("email");
    const emailHelp = document.getElementById("emailHelp");
    const pwHelp = document.getElementById("passwordHelp");

    function clearErrors(){
      emailHelp.textContent = "";
      pwHelp.textContent = "";
      email.classList.remove("is-error");
      pw.classList.remove("is-error");
    }

    function validate(){
      clearErrors();
      let ok = true;

      if(!email.value.trim() || !email.checkValidity()){
        ok = false;
        email.classList.add("is-error");
        emailHelp.textContent = "Please enter a valid email address.";
      }

      if(!pw.value.trim() || pw.value.length < 6){
        ok = false;
        pw.classList.add("is-error");
        pwHelp.textContent = "Password must be at least 6 characters.";
      }

      return ok;
    }

    // --------- AUTH FLOW (stubbed) ---------
    // Replace these with real backend checks later.
    function isReturningUser(emailValue){
      // Demo logic:
      // - any email ending with "@returning.com" is treated as returning user
      // - everything else is treated as new user
      return emailValue.toLowerCase().endsWith("@returning.com");
    }

    function redirectAfterAuth(emailValue){
      // If new user -> personalisation questionnaire
      // If returning -> hub
      const returning = isReturningUser(emailValue);
      window.location.href = returning ? ROUTES.hub : ROUTES.personalisation;
    }

    // Form submit
    const form = document.getElementById("authForm");
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      if(!validate()) return;

      // In real life:
      // - mode === "signup": create user, then send to personalisation
      // - mode === "signin": sign in, then send to hub
      // Here we follow your rule: new user -> personalisation, returning -> hub.
      redirectAfterAuth(email.value.trim());
    });

    // Provider buttons
    document.querySelectorAll("[data-provider]").forEach(btn => {
      btn.addEventListener("click", () => {
        const provider = btn.getAttribute("data-provider");

        // In real life, you‚Äôd redirect to your OAuth endpoint like:
        // window.location.href = `/auth/${provider}`;
        // For now we simulate:
        // - Providers also follow your rule: new -> personalisation, returning -> hub
        // We'll just send to a placeholder callback.
        const params = new URLSearchParams({ provider });
        window.location.href = `${ROUTES.providerCallback}?${params.toString()}`;
      });
    });
  </script>
</body>
</html>
